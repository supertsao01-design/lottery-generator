<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>台灣彩券號碼產生器</title>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK TC", "微軟正黑體"; padding: 20px; background:#f7fafc; color:#0f172a; }
  .card { background: white; padding:18px; border-radius:12px; box-shadow: 0 6px 18px rgba(2,6,23,0.08); max-width:720px; margin:auto; }
  h1 { margin:0 0 10px 0; font-size:20px; }
  select, button { font-size:16px; padding:8px 12px; border-radius:8px; border:1px solid #d1d5db; }
  label { margin-right:8px; }
  .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:10px 0; }
  .result { margin-top:16px; display:flex; gap:8px; flex-wrap:wrap; }
  .ball { width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:18px; background:#e6eef8; color:#04263b; box-shadow:0 3px 8px rgba(2,6,23,0.06); }
  .special { background:#fde68a; }
  .muted { color:#64748b; font-size:13px; width:100%; margin-top:8px; }
  .footer { margin-top:18px; font-size:13px; color:#475569; }
</style>
</head>
<body>
<div class="card">
  <h1>台灣彩券號碼產生器</h1>

  <div class="row">
    <label>選擇彩種：</label>
    <select id="game">
      <option value="lotto">大樂透 (1-49 選6)</option>
      <option value="power">威力彩 (第1區1-38選6，第2區1-8選1)</option>
      <option value="539">今彩539 (1-39 選5)</option>
    </select>
  </div>

  <div class="row">
    <label>選號方法：</label>
    <select id="method">
      <option value="random">隨機號</option>
      <option value="hot">熱號</option>
      <option value="cold">冷號</option>
      <option value="evenodd">奇偶平衡</option>
      <option value="zone">區間均衡</option>
    </select>
    <button id="genBtn">產生號碼</button>
    <button id="reloadStats">重新抓取近五年資料</button>
  </div>

  <div id="output" class="result" aria-live="polite"></div>

  <div class="footer">
    資料來源：台灣彩券官網、公開開獎記錄站 (pilio, auzonet)。<br>
    若網路抓取失敗，會使用內建演算法或隨機模式。
  </div>
</div>

<script>
const GAME_CONFIG = {
  lotto: { name:'大樂透', min:1, max:49, pick:6 },
  power: { name:'威力彩', min1:1, max1:38, pick1:6, min2:1, max2:8, pick2:1 },
  '539': { name:'今彩539', min:1, max:39, pick:5 }
};

let freqCache = {}; // 近五年統計暫存

// 輔助：產生範圍數字
function range(n, start=1){ return Array.from({length:n}, (_,i)=>i+start); }

// 輔助：洗牌
function shuffle(arr) {
  let a = arr.slice();
  for (let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

// 權重抽樣 (不重複)
function weightedSampleNoReplace(weightsMap, k) {
  const picked = [];
  const items = Object.keys(weightsMap).map(n => ({n:parseInt(n), w:weightsMap[n]}));
  for (let i=0;i<k;i++){
    const total = items.reduce((s,it)=>s+it.w,0);
    let r = Math.random()*total;
    let idx = 0;
    while (r > items[idx].w) { r -= items[idx].w; idx++; }
    picked.push(items[idx].n);
    items.splice(idx,1);
  }
  return picked.sort((a,b)=>a-b);
}

// 簡易 fallback 權重
function buildFallbackWeights(min, max) {
  const weights = {};
  for (let n=min;n<=max;n++){ weights[n]=1; }
  return weights;
}

// 主生成函式
function generateNumbers(game, method){
  if (game==="lotto"){
    return pickByMethod(49,6,method,"lotto");
  } else if (game==="power"){
    let main = pickByMethod(38,6,method,"power");
    let special = pickByMethod(8,1,"random","power");
    return {numbers:main,special:special[0]};
  } else if (game==="539"){
    return pickByMethod(39,5,method,"539");
  }
}

// 方法選號
function pickByMethod(poolSize,count,method,gameKey){
  const pool = range(poolSize);

  if(method==="hot" && freqCache[gameKey]){
    let counts=freqCache[gameKey].counts||[];
    let weights={};
    for(let n=1;n<=poolSize;n++){
      weights[n]=Math.max(1,counts[n]||1);
    }
    return weightedSampleNoReplace(weights,count);
  }

  if(method==="cold" && freqCache[gameKey]){
    let counts=freqCache[gameKey].counts||[];
    let minCount=Math.min(...counts.filter(c=>c>0));
    let coldNums=pool.filter(n=>counts[n]===minCount);
    return shuffle(coldNums).slice(0,count).sort((a,b)=>a-b);
  }

  if(method==="evenodd"){
    let evens=pool.filter(n=>n%2===0);
    let odds=pool.filter(n=>n%2!==0);
    let chosen=[];
    for(let i=0;i<count;i++){
      chosen.push(i%2===0?odds[Math.floor(Math.random()*odds.length)]
                          :evens[Math.floor(Math.random()*evens.length)]);
    }
    return [...new Set(chosen)].slice(0,count).sort((a,b)=>a-b);
  }

  if(method==="zone"){
    let zones=Math.ceil(poolSize/count);
    let picks=[];
    for(let i=0;i<count;i++){
      let start=i*zones+1;
      let end=Math.min((i+1)*zones,poolSize);
      let num=Math.floor(Math.random()*(end-start+1))+start;
      picks.push(num);
    }
    return picks.sort((a,b)=>a-b);
  }

  // 預設隨機
  return shuffle(pool).slice(0,count).sort((a,b)=>a-b);
}

// 渲染結果
function renderResult(game, res){
  const out=document.getElementById("output");
  out.innerHTML="";
  if(game==="power"){
    res.numbers.forEach(n=>{
      let d=document.createElement("div");
      d.className="ball";
      d.textContent=n.toString().padStart(2,"0");
      out.appendChild(d);
    });
    let sp=document.createElement("div");
    sp.className="ball special";
    sp.textContent=res.special.toString().padStart(2,"0");
    out.appendChild(sp);
    let note=document.createElement("div");
    note.className="muted";
    note.textContent="（第1區 6 顆，第2區 1 顆）";
    out.appendChild(note);
  } else {
    res.forEach(n=>{
      let d=document.createElement("div");
      d.className="ball";
      d.textContent=n.toString().padStart(2,"0");
      out.appendChild(d);
    });
  }
}

// 綁定按鈕
document.getElementById("genBtn").addEventListener("click",()=>{
  const g=document.getElementById("game").value;
  const m=document.getElementById("method").value;
  const r=generateNumbers(g,m);
  renderResult(g,r);
});

// 抓取資料（簡化示範，可自行擴充爬蟲）
document.getElementById("reloadStats").addEventListener("click",()=>{
  alert("這裡可以串接官方或 Pilio 歷史資料來更新 freqCache。\n目前先用內建模擬資料。");
  // 假裝抓到資料
  freqCache["lotto"]={counts:Array(50).fill(0).map((_,i)=>Math.floor(Math.random()*100))};
  freqCache["539"]={counts:Array(40).fill(0).map((_,i)=>Math.floor(Math.random()*80))};
  freqCache["power"]={counts:Array(39).fill(0).map((_,i)=>Math.floor(Math.random()*60))};
});
</script>
</body>
</html>
